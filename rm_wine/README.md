# 能量机关运动曲线拟合
## 0.运动公式
$(a * sin(w * (x + t_0)) + 2.090 - a)$  
## 1.简介
大能量机关转速按照三角函数呈周期性变化，其形状可以看作5个扇叶的风车，其中有一片特殊叫做待打击扇叶。角速度目标函数为：$spd = a ∗ sin(𝜔 ∗ 𝑡) + 𝑏$，其中 $spd$ 的单位为 $rad/s$，$t$ 的单位为 $s$，$a$ 的取值范围为 $0.780~1.045$，ω的取值范围为 $1.884~2.000$，$b$ 始终满足 $b=2.090-a$。每次大能量机关进入可激活状态时，所有参数重置，其中 $t$ 重置为 $0$，$a$ 和$ω$重置为取值范围内任意值。能量机关的实际转速与速度目标函数的时间误差在 $500ms$ 内。


## 1.傅里叶拟合过程
1. 对目标运动速度进行等时间间隔 $dt$ 采样$N$个点(目前采用插值方式采集数据)
2. 利用离散傅里叶变换求采样数据序列的离散傅里叶系数$F(k)$
3. 离散傅里叶系数模值$F(k_m)$最大所对应的频率值$2πk_0/N$即为所求频率$w$
4. 振幅为$a = 2F(k_m)/N$ 或 根据能量公式求$a$
5. 在求出振幅和频率后，通过类似方法求内积，内积最大值即为所求相位$t_0$

## 2.递推最小二乘法拟合过程
递推最小二乘法，拟合差分方程的系数。
任何一条曲线可以表示成泰勒级数的形式，离散系统下可以将微分化成差分，所以只要把arr[nf]到arr[nf+n]的数据作为方程组Ax=B的A，arr[0]作为B，就能通过递推最小二乘得到未知系数x了
在这个里面nf是子弹飞行时间对应的帧数，n是模型阶数，在预测的时候可以拿arr[0]到arr[n]来预测nf帧之后的
ps:参数辨识是根据实验数据和建立的模型来确定一组参数值，使得由模型计算得到的数值结果能最好的拟合测试数据（曲线拟合问题），从而可以为生产过程进行预测，提供一定的理论指导。
当计算得到的数值结果与测试值之间的误差较大时，就认为该数学模型与实际的过程不符或者差距较大，进而修改模型，重新选择参数。因此，参数辨识问题是一个逆问题，参数估计的好坏决定了用模型来解释实际问题的可信度。

假设我们要拟合的周期三角函数为：
f(x) = A * sin(2πx/T + φ) + C
其中，A为振幅，T为周期，φ为相位差，C为偏移量。
我们有一组观测数据(x_i, y_i)，其中x_i对应的函数值为y_i。我们的目标是找到最佳的拟合参数(A, T, φ, C)使得拟合函数f(x_i)与观测值y_i的残差平方和最小化。
首先，我们可以将问题转化为求解以下最小化问题：
min Σ(y_i - f(x_i))^2
其中，Σ表示对所有观测数据的求和。
然后，我们可以通过最小化这个残差平方和来求解最佳的拟合参数。这可以通过求解一组非线性方程来实现，例如使用数值优化方法，如牛顿法或共轭梯度法。
在求解过程中，我们需要选择合适的初始参数值，并将观测数据与拟合函数进行迭代优化，以使得残差平方和趋近于最小值。
需要注意的是，最小二乘法提供了一种拟合周期三角函数的方法，但结果仍然依赖于选择的初始参数值和观测数据的质量。因此，在使用最小二乘法进行拟合时，需要对初始参数和数据进行适当的选择和处理，以得到合理的拟合结果。

当使用最小二乘法结合差分方程来预测待打击扇叶转过的角度时，可以按照以下步骤进行具体计算和建模：
收集已知时间内待打击扇叶的转速数据。假设有N个采样点，每个采样点的时间和对应的转速分别为 ti 和 si。
使用最小二乘法进行多项式拟合来逼近待打击扇叶的角速度目标函数。选择一个适当的多项式阶数（如2阶或3阶），
将待打击扇叶的角速度目标函数表示为一个多项式函数：
ω_target(t) = c0 + c1t + c2t^2 + ...+ cn*t^n
其中，c0、c1、c2等是待求解的多项式系数。
使用最小二乘法，拟合上述多项式函数到你收集到的转速数据上。求解出多项式系数 c0, c1, c2, ... , cn。
构建正规方程矩阵。将拟合多项式表示为矩阵形式，即将待打击扇叶的转速数据构建成一个矩阵X，其中每一行为 [1, ti, ti^2, ...]，并将对应的转速数据构建成一个列向量y。
X = [[1, t1, t1^2, ...], [1, t2, t2^2, ...], ... [1, tN, tN^2, ...]]
y = [[s1], [s2], ... [sN]]
求解多项式系数。应用最小二乘法的公式，求解出多项式系数c0、c1、c2、...。公式如下：
[c0, c1, c2, ...] = (X^T * X)^-1 * X^T * y
其中，^T表示矩阵的转置，^-1表示矩阵的逆。
接下来，你可以通过差分方程来预测待打击扇叶转过的角度。假设要预测的时间段为 t_start 到 t_end，时间步长为 Δt。首先将初始角度θ设置为0。
对于时间步长内的每个时间点t，应用差分方程来更新角度θ，公式如下：
θ(t + Δt) = θ(t) + ω_target(t) * Δt
重复以上步骤，直到达到预测的时间段t_end。
通过以上步骤，可以利用最小二乘法结合差分方程来预测待打击扇叶在给定时间段内转过的角度。
如果需要更多详细的公式推导或参数计算，我需要知道具体的待打击扇叶转速数据和预测时间段范围，以便为你提供具体的计算结果。

## 3.基于二分迭代最小二乘法拟合过程


## 4.基于动量法逼近过程